{
  "tool": "fastify",
  "category": "web_framework",
  "common_errors": [
    {
      "error": "ROUTE_NOT_FOUND",
      "pattern": "Route.*not found|404 Not Found|Cannot.*route",
      "severity": "medium",
      "causes": [
        "Route not registered",
        "Wrong HTTP method",
        "Route registered after listen",
        "Plugin not registered"
      ],
      "solutions": [
        "Register route before server.listen()",
        "Check method matches: GET vs POST",
        "Verify plugin containing routes is registered",
        "Use fastify.printRoutes() to debug"
      ]
    },
    {
      "error": "PLUGIN_ALREADY_REGISTERED",
      "pattern": "already.*registered|Plugin.*registered twice|avoid.*twice",
      "severity": "medium",
      "causes": [
        "Same plugin registered multiple times",
        "Plugin imported in multiple places",
        "Not using fastify-plugin wrapper"
      ],
      "solutions": [
        "Use fastify-plugin for shareable plugins",
        "Import plugin once at top level",
        "Use { name: 'unique' } option",
        "Check plugin dependencies"
      ]
    },
    {
      "error": "SCHEMA_VALIDATION_FAILED",
      "pattern": "body.*must.*have|validation.*failed|Invalid.*schema",
      "severity": "medium",
      "causes": [
        "Request doesn't match schema",
        "Missing required fields",
        "Wrong data types",
        "Schema definition error"
      ],
      "solutions": [
        "Check request body matches schema",
        "Use ajv-formats for format validation",
        "Review schema definition",
        "Enable setErrorHandler for custom messages"
      ]
    },
    {
      "error": "DECORATOR_NOT_FOUND",
      "pattern": "decorator.*not found|request\\..*undefined|reply\\..*undefined",
      "severity": "high",
      "causes": [
        "Decorator not registered",
        "Plugin not awaited",
        "Decorator in wrong scope",
        "Using before registration"
      ],
      "solutions": [
        "Register decorator: fastify.decorateRequest('prop', null)",
        "Await plugin registration: await fastify.register(plugin)",
        "Check plugin scope (encapsulation)",
        "Use fastify-plugin for scope-breaking"
      ]
    },
    {
      "error": "ASYNC_HOOK_ERROR",
      "pattern": "async.*error|hook.*rejected|unhandled.*promise",
      "severity": "high",
      "causes": [
        "Async hook not awaited",
        "Error in hook not caught",
        "done() called with async",
        "Promise rejection in hook"
      ],
      "solutions": [
        "Use async/await in hooks",
        "Don't mix done() callback with async",
        "Add try/catch in async hooks",
        "Throw errors to trigger error handler"
      ]
    },
    {
      "error": "SERIALIZATION_ERROR",
      "pattern": "serialization.*error|Cannot.*stringify|circular.*reference",
      "severity": "medium",
      "causes": [
        "Circular reference in response",
        "BigInt serialization",
        "Custom types not serializable",
        "Reply schema mismatch"
      ],
      "solutions": [
        "Use custom serializer for complex types",
        "Remove circular references",
        "Add schema to reply for fast serialization",
        "Use fast-json-stringify options"
      ]
    },
    {
      "error": "ENCAPSULATION_LEAK",
      "pattern": "encapsulation.*broken|plugin.*not.*isolated|decorator.*leaked",
      "severity": "medium",
      "causes": [
        "Using fastify-plugin incorrectly",
        "Breaking encapsulation intentionally",
        "Global decorators in plugin",
        "Not understanding plugin scope"
      ],
      "solutions": [
        "Remove fastify-plugin if isolation needed",
        "Use fastify-plugin only for truly shared plugins",
        "Understand Fastify encapsulation model",
        "Use register() for scoped plugins"
      ]
    },
    {
      "error": "SERVER_ALREADY_STARTED",
      "pattern": "server.*already.*started|Cannot.*after listen|started.*error",
      "severity": "medium",
      "causes": [
        "Registering routes after listen()",
        "Adding plugins after start",
        "Multiple listen() calls",
        "Configuration after server start"
      ],
      "solutions": [
        "Register all routes/plugins before listen()",
        "Use ready() hook for post-registration setup",
        "Call listen() only once",
        "Structure app with proper lifecycle"
      ]
    },
    {
      "error": "CONTENT_TYPE_ERROR",
      "pattern": "content-type.*not supported|Unsupported Media Type|parser.*not found",
      "severity": "medium",
      "causes": [
        "Content-Type not registered",
        "Missing parser for content type",
        "Wrong Content-Type header",
        "Body parser limit exceeded"
      ],
      "solutions": [
        "Add content type parser: fastify.addContentTypeParser()",
        "Use @fastify/multipart for form-data",
        "Check Content-Type header matches body",
        "Increase body limit: bodyLimit: 10485760"
      ]
    }
  ],
  "best_practices": [
    "Use JSON Schema for request/response validation",
    "Leverage Fastify plugin system for modularity",
    "Use async/await consistently, avoid callbacks",
    "Add custom error handler with setErrorHandler",
    "Use decorators for shared utilities",
    "Enable logging with pino",
    "Structure app with plugins and encapsulation"
  ],
  "related_tools": ["express", "koa", "hapi", "nestjs"]
}
