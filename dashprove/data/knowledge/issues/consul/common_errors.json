{
  "tool": "consul",
  "category": "service_discovery",
  "description": "HashiCorp Consul - service mesh and service discovery",
  "common_errors": [
    {
      "id": "no_cluster_leader",
      "pattern": "No cluster leader",
      "regex": "(?i)no cluster leader|leadership.*lost|election.*failed",
      "cause": "Consul cluster has no elected leader, usually due to quorum loss",
      "solution": "Ensure majority of server nodes are healthy, check network connectivity between servers",
      "severity": "critical",
      "category": "cluster"
    },
    {
      "id": "agent_not_running",
      "pattern": "agent: failed",
      "regex": "(?i)agent.*failed|agent.*not.*running|consul.*connect",
      "cause": "Consul agent is not running or cannot be reached",
      "solution": "Start the agent with 'consul agent', check systemd service status",
      "severity": "high",
      "category": "operational"
    },
    {
      "id": "acl_denied",
      "pattern": "ACL not found",
      "regex": "(?i)acl.*not found|acl.*denied|permission denied|token.*invalid",
      "cause": "ACL token is missing, invalid, or lacks required permissions",
      "solution": "Provide valid token with CONSUL_HTTP_TOKEN or -token flag, check ACL policies",
      "severity": "medium",
      "category": "authentication"
    },
    {
      "id": "service_registration_failed",
      "pattern": "service registration failed",
      "regex": "(?i)service registration failed|failed to register|catalog.*error",
      "cause": "Unable to register service with Consul catalog",
      "solution": "Check service definition JSON/HCL syntax, verify agent connectivity, ensure unique service ID",
      "severity": "medium",
      "category": "service_discovery"
    },
    {
      "id": "connect_proxy_error",
      "pattern": "connect proxy",
      "regex": "(?i)connect.*proxy|sidecar.*error|envoy.*failed",
      "cause": "Service mesh proxy (Envoy) configuration or connectivity issue",
      "solution": "Check proxy configuration in service definition, verify Envoy bootstrap config, review proxy logs",
      "severity": "high",
      "category": "service_mesh"
    },
    {
      "id": "dns_not_responding",
      "pattern": "DNS lookup failed",
      "regex": "(?i)dns.*failed|nxdomain|service.*consul.*not resolve",
      "cause": "Consul DNS interface not responding or misconfigured",
      "solution": "Ensure Consul is listening on DNS port (8600), configure system DNS or dnsmasq for .consul domain",
      "severity": "medium",
      "category": "dns"
    },
    {
      "id": "gossip_encryption",
      "pattern": "gossip: encrypt",
      "regex": "(?i)gossip.*encrypt|serf.*key|encryption.*mismatch",
      "cause": "Gossip encryption key mismatch between agents",
      "solution": "Ensure all agents use the same gossip encryption key, rotate keys carefully",
      "severity": "high",
      "category": "security"
    },
    {
      "id": "health_check_failed",
      "pattern": "health check failed",
      "regex": "(?i)health check.*failed|check.*critical|check.*warning",
      "cause": "Service health check is failing",
      "solution": "Review check script/HTTP endpoint, adjust check interval/timeout, check service health",
      "severity": "medium",
      "category": "health"
    },
    {
      "id": "raft_snapshot_error",
      "pattern": "raft: snapshot",
      "regex": "(?i)raft.*snapshot|snapshot.*failed|state.*restore",
      "cause": "Error creating or restoring Raft snapshot",
      "solution": "Check disk space, verify data directory permissions, review server logs",
      "severity": "high",
      "category": "cluster"
    },
    {
      "id": "wan_federation_error",
      "pattern": "WAN federation",
      "regex": "(?i)wan.*federation|datacenter.*unreachable|cross.*dc",
      "cause": "Multi-datacenter WAN federation connectivity issue",
      "solution": "Check WAN gossip port (8302) connectivity between datacenters, verify server addresses",
      "severity": "high",
      "category": "federation"
    }
  ],
  "related_tools": ["vault", "nomad", "envoy", "terraform"],
  "documentation_url": "https://developer.hashicorp.com/consul/docs"
}
