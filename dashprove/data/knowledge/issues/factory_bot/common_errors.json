{
  "tool": "factory_bot",
  "category": "test_data_generation",
  "common_errors": [
    {
      "error_pattern": "Factory not registered",
      "description": "Attempted to use factory that doesn't exist",
      "causes": [
        "Factory file not loaded",
        "Typo in factory name",
        "Factory defined in wrong directory"
      ],
      "solutions": [
        "Ensure factories loaded: require 'factory_bot'",
        "Check factory name matches definition",
        "Place factories in spec/factories/ or test/factories/",
        "Load path: FactoryBot.find_definitions"
      ]
    },
    {
      "error_pattern": "ActiveRecord::RecordInvalid",
      "description": "Factory created invalid record",
      "causes": [
        "Missing required attributes",
        "Validation failures",
        "Association not satisfied"
      ],
      "solutions": [
        "Add required attributes to factory",
        "Use traits for different scenarios",
        "Add associations: association :user",
        "Use create_list or build_stubbed to skip validations"
      ]
    },
    {
      "error_pattern": "undefined method.*for.*FactoryBot",
      "description": "FactoryBot method called incorrectly",
      "causes": [
        "Method doesn't exist",
        "Using deprecated API",
        "Wrong FactoryBot version"
      ],
      "solutions": [
        "Use create, build, build_stubbed, attributes_for",
        "Update deprecated methods: FactoryGirl -> FactoryBot",
        "Check version compatibility"
      ]
    },
    {
      "error_pattern": "Trait not registered",
      "description": "Using undefined trait",
      "causes": [
        "Trait name typo",
        "Trait defined in different factory",
        "Trait not loaded"
      ],
      "solutions": [
        "Define trait in factory: trait :admin do; admin true; end",
        "Use correct trait name: create(:user, :admin)",
        "Define global traits in FactoryBot.define block"
      ]
    },
    {
      "error_pattern": "Association.*not found",
      "description": "Associated factory doesn't exist",
      "causes": [
        "Parent factory not defined",
        "Circular association dependency"
      ],
      "solutions": [
        "Define associated factory",
        "Use factory: option: association :author, factory: :user",
        "Break circular deps with lazy evaluation"
      ]
    },
    {
      "error_pattern": "undefined.*sequence",
      "description": "Sequence referenced but not defined",
      "causes": [
        "Sequence name wrong",
        "Sequence defined in wrong scope"
      ],
      "solutions": [
        "Define sequence: sequence(:email) { |n| \"user#{n}@example.com\" }",
        "Use generate: generate(:email)",
        "Define global sequences outside factories"
      ]
    },
    {
      "error_pattern": "KeyError.*attribute",
      "description": "Referenced attribute doesn't exist",
      "causes": [
        "Attribute name wrong in transient or callback",
        "Accessing evaluator attribute incorrectly"
      ],
      "solutions": [
        "Use evaluator in callback: after(:create) { |obj, evaluator| }",
        "Define transient attribute: transient { extra_data { nil } }"
      ]
    },
    {
      "error_pattern": "NoMethodError.*nil.*class",
      "description": "Factory cannot determine model class",
      "causes": [
        "No class specified and inference failed",
        "Model doesn't exist"
      ],
      "solutions": [
        "Specify class: factory :admin_user, class: 'User'",
        "Ensure model exists",
        "Use parent: factory :admin_user, parent: :user"
      ]
    },
    {
      "error_pattern": "FactoryBot::DuplicateDefinition",
      "description": "Factory defined multiple times",
      "causes": [
        "Factory file loaded twice",
        "Same factory name in different files"
      ],
      "solutions": [
        "Remove duplicate definition",
        "Use unique factory names",
        "Check require statements"
      ]
    },
    {
      "error_pattern": "build_stubbed.*persistence",
      "description": "build_stubbed object tried to persist",
      "causes": [
        "Called save on stubbed object",
        "Association triggered persistence"
      ],
      "solutions": [
        "Don't call save! on stubbed objects",
        "Use strategy: :build_stubbed in associations",
        "Use build if you need to save later"
      ]
    },
    {
      "error_pattern": "Callback.*error",
      "description": "Error in after(:create) or similar callback",
      "causes": [
        "Callback code raises exception",
        "Dependency not available in callback"
      ],
      "solutions": [
        "Debug callback code",
        "Ensure dependencies exist before callback",
        "Use create_list for multiple records"
      ]
    }
  ]
}
