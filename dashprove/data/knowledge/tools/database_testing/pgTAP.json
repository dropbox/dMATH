{
  "id": "pgtap",
  "name": "pgTAP",
  "category": "testing",
  "subcategory": "database_testing",

  "description": "Unit testing framework for PostgreSQL",
  "long_description": "pgTAP is a suite of database functions that make it easy to write TAP-emitting unit tests in psql scripts or xUnit-style test functions. It provides comprehensive assertion functions for testing PostgreSQL schemas, data, and functions. Tests run inside the database using standard SQL.",

  "capabilities": [
    "schema_testing",
    "data_testing",
    "function_testing",
    "constraint_testing",
    "tap_output",
    "transaction_rollback",
    "coverage_analysis"
  ],
  "property_types": ["correctness", "schema_compliance"],
  "input_languages": ["sql", "plpgsql"],
  "output_formats": ["tap"],

  "installation": {
    "methods": [
      {"type": "apt", "command": "apt install postgresql-*-pgtap", "platform": "linux"},
      {"type": "brew", "command": "brew install pgtap", "platform": "macos"},
      {"type": "pgxn", "command": "pgxn install pgtap"}
    ],
    "dependencies": ["postgresql"],
    "platforms": ["linux", "macos"]
  },

  "documentation": {
    "official": "https://pgtap.org/",
    "tutorial": "https://pgtap.org/documentation.html",
    "api_reference": "https://pgtap.org/documentation.html#assertions",
    "examples": "https://github.com/theory/pgtap/tree/main/test/sql"
  },

  "tactics": [
    {
      "name": "basic_test",
      "description": "Write basic pgTAP test",
      "syntax": "SELECT plan(1); SELECT ok(true, 'test passes'); SELECT finish();",
      "when_to_use": "Testing database objects",
      "examples": ["SELECT has_table('users', 'users table exists');"]
    },
    {
      "name": "run_tests",
      "description": "Run test suite with pg_prove",
      "syntax": "pg_prove -d mydb test/*.sql",
      "when_to_use": "Running test suite",
      "examples": ["pg_prove -d testdb --verbose test/"]
    },
    {
      "name": "schema_tests",
      "description": "Test schema structure",
      "syntax": "SELECT has_column('table', 'column', 'description');",
      "when_to_use": "Schema validation",
      "examples": ["SELECT col_type_is('users', 'email', 'varchar(255)');"]
    }
  ],

  "error_patterns": [
    {
      "pattern": "not ok \\d+ -",
      "meaning": "Test failed",
      "common_causes": ["Assertion didn't match", "Missing object"],
      "fixes": ["Fix implementation or update test"]
    },
    {
      "pattern": "Bail out!",
      "meaning": "Critical failure, tests aborted",
      "common_causes": ["Connection error", "Fatal SQL error"],
      "fixes": ["Check database connection", "Fix SQL syntax"]
    }
  ],

  "integration": {
    "dashprove_backend": true,
    "usl_property_types": ["correctness"],
    "cli_command": "dashprove verify --backend pgtap"
  },

  "performance": {
    "typical_runtime": "Fast; runs in database",
    "scalability": "Good",
    "memory_usage": "Database dependent"
  },

  "comparisons": {
    "similar_tools": ["utplsql", "tsqlt", "dbfit"],
    "advantages": ["PostgreSQL native", "Comprehensive assertions", "TAP output"],
    "disadvantages": ["PostgreSQL only"]
  },

  "metadata": {
    "version": "1.3.3",
    "last_updated": "2025-12-22",
    "maintainer": "David E. Wheeler",
    "license": "PostgreSQL"
  }
}
