# Ninja - Small Build System with a Focus on Speed

Ninja is a small build system with a focus on speed. It is designed to have its input files generated by a higher-level build system like CMake, Meson, or GN.

## Features

- **Speed**: Optimized for fast incremental builds
- **Simplicity**: Minimal syntax, generated by other tools
- **Parallelism**: Efficient parallel execution
- **Dependencies**: Precise dependency tracking

## Installation

```bash
# macOS
brew install ninja

# Ubuntu/Debian
sudo apt install ninja-build

# From source
git clone https://github.com/ninja-build/ninja.git
cd ninja && ./configure.py --bootstrap
```

## Basic Usage

```bash
# Build all targets
ninja

# Build specific target
ninja mytarget

# Build multiple targets
ninja target1 target2

# Parallel jobs (default: auto-detect)
ninja -j 8

# Show commands without executing
ninja -n

# Verbose output
ninja -v

# Clean all outputs
ninja -t clean

# Build and keep going on errors
ninja -k 0
```

## build.ninja Syntax

### Basic Structure

```ninja
# Variables
cflags = -Wall -O2
cc = gcc

# Rules
rule cc
  command = $cc $cflags -c $in -o $out
  description = Compiling $out

rule link
  command = $cc $in -o $out
  description = Linking $out

# Build edges
build main.o: cc main.c
build utils.o: cc utils.c
build program: link main.o utils.o

# Default target
default program
```

### Variables

```ninja
# Global variables
builddir = build
cflags = -Wall -Wextra

# Rule-scoped variables
rule cc
  command = gcc $cflags -c $in -o $out
  description = CC $out

# Build-scoped variables
build main.o: cc main.c
  cflags = $cflags -O2
```

### Built-in Variables

```ninja
# $in - input files
# $out - output files
# $in_newline - inputs, one per line
# $out_newline - outputs, one per line
```

### Dependencies

```ninja
# Implicit dependencies (rebuild if changed, not in command)
build foo.o: cc foo.c | foo.h bar.h

# Order-only dependencies (must exist, don't trigger rebuild)
build foo.o: cc foo.c || dir

# Depfile (generated dependency file)
rule cc
  command = gcc -MMD -MF $out.d -c $in -o $out
  depfile = $out.d
  deps = gcc
```

### Pools

```ninja
# Limit parallel jobs for resource-intensive tasks
pool heavy_pool
  depth = 1

rule heavy
  command = heavy_process $in $out
  pool = heavy_pool
```

### Phony Rules

```ninja
# Phony target (always out of date)
build all: phony program tests docs
build clean: phony

# With action
rule clean_action
  command = rm -rf build/

build clean: clean_action
```

## Generated by Build Systems

### CMake

```bash
# Generate with Ninja
cmake -G Ninja -B build
cmake --build build

# Or
cd build && ninja
```

### Meson

```bash
meson setup builddir
cd builddir && ninja
```

### GN (Chromium)

```bash
gn gen out/Default
ninja -C out/Default
```

## Tools

```bash
# Show build graph
ninja -t graph | dot -Tpng > graph.png

# Show targets
ninja -t targets

# Show rules
ninja -t rules

# Show deps for target
ninja -t deps program

# Show commands for target
ninja -t commands program

# Query why target needs rebuild
ninja -t query target

# Compdb (for IDE integration)
ninja -t compdb > compile_commands.json

# Clean outputs
ninja -t clean
ninja -t clean target

# Clean everything (like make clean)
ninja -t cleandead

# Browse dependencies
ninja -t browse --port=8000
```

## Comparison with Make

| Feature | Ninja | Make |
|---------|-------|------|
| Speed | Faster | Slower |
| Syntax | Simple, generated | Complex, hand-written |
| Features | Minimal | Rich |
| Primary use | Generated by CMake/Meson | Hand-written or generated |
| Parallel builds | Excellent | Good |
| Dep tracking | Precise | Manual |

## Performance Tips

1. **Use depth pools** for memory-intensive rules
2. **Enable depfiles** for accurate incremental builds
3. **Use response files** for long command lines
4. **Avoid phony targets** when possible
5. **Keep build.ninja generated** by CMake/Meson

## Response Files

```ninja
# For very long command lines
rule link
  command = $cxx @$out.rsp -o $out
  rspfile = $out.rsp
  rspfile_content = $in $libs
```

## Advanced Features

### Subninja

```ninja
# Include other ninja files
subninja lib/build.ninja
subninja app/build.ninja
```

### Include

```ninja
# Include variable definitions
include common.ninja
```

### Console Pool

```ninja
# Interactive commands (one at a time, with terminal access)
pool console
  depth = 1

rule interactive
  command = ./configure
  pool = console
```

## Documentation

- Official: https://ninja-build.org/manual.html
- GitHub: https://github.com/ninja-build/ninja
- Syntax Reference: https://ninja-build.org/manual.html#_writing_your_own_ninja_files
